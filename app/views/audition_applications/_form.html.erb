<div class="container mt-3 mb-3" style="width:70%; ">
  <h2>Fill up this application form</h2>
  <%= simple_form_for(@audition_application || AuditionApplication.new) do |f| %>
    <%= f.input :first_name, label: "Prénom", required: true %>
    <%= f.input :last_name, label: "Nom de famille", required: true %>
    <%= f.input :date_of_birth, as: :date, label: "Date de naissance", required: true, start_year: 1900, end_year: Date.today.year %>
    <%= f.input :nationality, label: "Nationalité", required: true %>
    <%= f.input :address, label: "Address", required: true %>
    <%= f.input :height, label: "Taille", required: true %>
    <%= f.input :gender, collection: ["male", "female", "non-binary", "other"], label: "Sexe", required: true %>
    <p>Make sure to upload a youtube video by coping the url, ex: "https://www.youtube.com/watch?v=MOPOb52MkOQ" </p>
    <%= f.input :video_link, label: "Lien vers la vidéo", required: true %>

    <div class="d-flex justify-content-around mb-3">

      <div class="custom-file">
        <label for="cv-upload" class="custom-file-label">Upload CV</label>
        <span id="cv-file-name">No file chosen</span>
        <%= f.input :cv, as: :file, required: true,
                      input_html: { class: "custom-file-input", id: "cv-upload", onchange: "updateFileName(this, 'cv-file-name')" },
                      accept: "application/pdf",
                      label: false %>
      </div>

      <div class="custom-file">
        <label for="profile-image-upload" class="custom-file-label">Upload Photo</label>
        <span id="profile-image-file-name">No file chosen</span>
        <%= f.input :profile_image, as: :file, required: true,
                      input_html: { class: "custom-file-input", id: "profile-image-upload", onchange: "updateFileName(this, 'profile-image-file-name')" },
                      accept: "image/png, image/jpeg, image/gif, image/jpg, image/webp",
                      label: false %>
      </div>
    </div>


    <%= f.button :submit, f.object.persisted? ? 'Modifier' : 'Soumettre la candidature', class:"submit-button" %>
  <% end %>
</div>
<script>
  function updateFileName(input, labelId) {
    const fileName = input.files.length > 0 ? input.files[0].name : "No file chosen";
    document.getElementById(labelId).textContent = fileName;
  }
  function updateFileName(input, labelId) {
    const allowedCVTypes = ["application/pdf"];
    const allowedImageTypes = ["image/png", "image/jpeg", "image/gif," "image/jpg", "image/webp"];

    const file = input.files[0];
    if (file) {
      const fileType = file.type;
      const isCV = input.id === "cv-upload";

      if ((isCV && !allowedCVTypes.includes(fileType)) ||
          (!isCV && !allowedImageTypes.includes(fileType))) {
        alert("Invalid file type! Please upload a " + (isCV ? "PDF." : "JPG, PNG, or GIF."));
        input.value = ""; // Reset file input
        document.getElementById(labelId).textContent = "No file chosen";
        return;
      }

      document.getElementById(labelId).textContent = file.name;
    }
  }
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form"); // Select the form
    form.addEventListener("submit", function (event) {
      if (!form.checkValidity()) {
        event.preventDefault(); // Prevent form submission
        event.stopPropagation();

        // Show custom alert (Bootstrap example)
        let alertDiv = document.createElement("div");
        alertDiv.className = "alert alert-danger mt-2";
        alertDiv.innerHTML = "Veuillez remplir tous les champs obligatoires.";
        form.prepend(alertDiv); // Insert alert at the top of the form
      }

      form.classList.add("was-validated"); // Add Bootstrap validation class
    });
  });
</script>
