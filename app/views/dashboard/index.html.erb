<div id="div-index" data-controller="toggle-index-dashboard">
  <div class="mx-5 mb-4">
    <h1>Dashboard</h1>
    <%= link_to 'Applications', audition_applications_path, class: 'link' %><br>
    <button data-action="click->toggle-index-dashboard#toggleView" class="submit-button">Toggle View</button>
  </div>
  <!-- Toggle Button -->
  <div id="dashboard" data-toggle-index-dashboard-target="table">
    <div data-controller="dashboard" class='scrollable-div'>
      <div class="mb-3">
        <%= link_to "Charge Dashboard", request.fullpath, class: "link" %>
      </div>
      <table id="dashboard-table" class="styled-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Nationality</th>
            <th>Gender</th>
            <th>Status</th>
            <th>Ethnicity</th>
            <th>Votes</th>
            <th>Result</th>
            <th>Email</th>
            <th>Video Link</th>
            <th>CV</th>
            <th>Confirmed Attendance</th>
          </tr>
        </thead>
        <tbody></tbody> <!-- DataTables will populate this dynamically -->
      </table>
    </div>
    <div class="container description">
      <table>
        <thead>
          <tr style="background-color: #222; color: #fff;">
            <th style="border: 1px solid #444; padding: 5px;">Votes (star, yes, maybe, no)</th>
            <th style="border: 1px solid #444; padding: 5px;">Output</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">yes, yes, yes</td>
            <td style="border: 1px solid #444; padding: 5px;">YES ‚úÖ</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">star, no, no</td>
            <td style="border: 1px solid #444; padding: 5px;">YES ‚≠êÔ∏è (because 'star' is present)</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">star, maybe, maybe</td>
            <td style="border: 1px solid #444; padding: 5px;">YES ‚≠êÔ∏è (because 'star' is present)</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">yes, star, no</td>
            <td style="border: 1px solid #444; padding: 5px;">YES ‚≠êÔ∏è (because 'star' is present)</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">yes, yes, maybe</td>
            <td style="border: 1px solid #444; padding: 5px;">MAYBE+ üü°</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">yes, maybe, maybe</td>
            <td style="border: 1px solid #444; padding: 5px;">MAYBE+ üü°</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">maybe, maybe, maybe</td>
            <td style="border: 1px solid #444; padding: 5px;">MAYBE üü†</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">maybe, maybe, no</td>
            <td style="border: 1px solid #444; padding: 5px;">MAYBE üü†</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">maybe, no, no</td>
            <td style="border: 1px solid #444; padding: 5px;">NO üî¥</td>
          </tr>
          <tr>
            <td style="border: 1px solid #444; padding: 5px;">no, no, no</td>
            <td style="border: 1px solid #444; padding: 5px;">NO üî¥</td>
          </tr>
        </tbody>
      </table>
      <p padding="5px">In the Votes column, the numbers represent from left to right "star", "yes", "maybe", "no".<br>
      In case of a star from C√©dric, the final result is going to be YES.<br>
      Ex.1 In the case of row with id 1: 0 star, 0 yes, 1 maybe, 2 no... therefore the final result is NO.<br>
      EX.2 In the case of row with id 9: only two have voted but, since C√©dric put a star, the final result is YES.</p>
    </div>
  </div>
  <div id="index" data-toggle-index-dashboard-target="index" style="display: none;">
    <div class="container">
      <h2>Index Section</h2>
      <%= form_with url: dashboard_index_path, method: :get, local: true, data: { turbo_frame: "applications_list" } do |form| %>
        <!-- Vote Filter -->
        <div class="third">
          <%= form.label :vote, 'Select Vote Status' %> <br>
          <% vote_options = ["not set", 'yes'] %>
          <% vote_options << 'star' if current_user.director? %>
          <% vote_options += ['maybe', 'no'] %>

          <%= form.select :vote, options_for_select(vote_options, @selected_vote), { prompt: "Everyone" }, { onchange: 'this.form.requestSubmit();' } %>
        </div>
      <% end %>
    </div>

    <!-- Turbo Frame for live updates -->
    <turbo-frame id="applications_list">
      <div>
        <section class="tiles-index my-4">
          <% @applications.each do |application| %>
            <article class="style1 tile <%= application.confirmed_attendance ? 'confirmed' : 'not-confirmed' %>" id="votes_<%= application.id %>">
              <!-- Profile Image -->
              <span class="image">
                <% if application.profile_image.present? %>
                  <%= image_tag(application.profile_image) %>
                <% else %>
                  <%= cl_image_tag application.photo.key %>
                <% end %>
              </span>

              <!-- Load show view dynamically in a Turbo Frame -->
              <a href="<%= audition_application_path(application) %>" data-turbo-frame="_top">
                <h3 id="text-tiles"><%= application.first_name %> <%= application.last_name %></h3>
                <br>
                <h5><%= application.nationality %></h5>
                <div class="content">
                  <h5><%= application.height %>m</h5>
                </div>
              </a>
            </article>
          <% end %>
        </section>
      </div>
    <!-- This is where the show page will load dynamically -->
    </turbo-frame>
  </div>
</div>
    <%# <turbo-frame id="application_show"></turbo-frame> %>
<!-- Include DataTables -->
<%= javascript_include_tag 'https://code.jquery.com/jquery-3.6.0.min.js' %>
<%= javascript_include_tag 'https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js' %>
<%= stylesheet_link_tag 'https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css' %>
